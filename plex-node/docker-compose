version: '3.7'

services:
  plex:
    image: elcrp96/plex-media-server
    container_name: plex
    network_mode: host
    environment:
      - PUID=999
      - PGID=995
      - VERSION=docker
      - PLEX_CLAIM= #optional
    volumes:
      - /mnt/storage/local/plex:/config/Library/Application Support/Plex Media Server # Where you want your Plex Library/Config folder to be
      - /mnt/storage/local/plex/transcode:/transcode # A path for transcoding
      - /mnt/storage/local/plex/transcode/Sync+:/config/Library/Application Support/Plex Media Server/Cache/Transcode/Sync+ # To keep sync transcoding in the transcode folder
      - /mnt/storage/local/plex/transcode/Sync:/config/Library/Application Support/Plex Media Server/Cache/Transcode/Sync   # To keep sync transcoding in the transcode folder
      - /mnt/storage/sync/media:/mnt/media # Media folder
      - /mnt/storage/local/certs/plex/node.pfx:/certs/node.pfx # Certificate File
    restart: unless-stopped
      
      
      
  # A proxy based on nginx that sits between the Plex server and
  # the internet. Every time a request is made to Plex, if that
  # request is to mark status, an API call is made
  # to plex-cluster-manager.
  #
  # There is one of these for every Plex server.
  plex-cluster-proxy:
    image: elcrp96/plex-cluster-proxy
    container_name: plex-proxy
    network_mode: host
    environment:
      - PLEX_IP=127.0.092.168.0.202
      - PLEX_PORT=32400
      - HTTPS_HOST=plex-northwyck.nowsci.com
      - HTTPS_PORT=32300
      - RESOLVERS=192.168.0.1
      - SSL_CERTIFICATE=/certs/fullchain.pem
      - SSL_CERTIFICATE_KEY=/certs/privkey.pem
      - CLUSTER_MANAGER=http://plex-cluster-manager:3400
      - CLUSTER_MANAGER_TOKEN=ts3wJgUNaJ6DcB7FhhYGcUpaa9DwPy
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - /mnt/storage/local/certs/nginx/fullchain.pem:/certs/fullchain.pem:ro
      - /mnt/storage/local/certs/nginx/privkey.pem:/certs/privkey.pem:ro
      - plex-cluster-proxy:/data
    ports:
      - 32300:32300
    restart: always

volumes:
  plex-cluster-proxy:
